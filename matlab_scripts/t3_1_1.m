clear, clc;

time = [12.683333333333334, 12.733333333333333, 12.783333333333333, 12.833333333333334, 12.883333333333333, 12.933333333333334, 12.983333333333333, 13.033333333333333, 13.083333333333334, 13.133333333333333, 13.183333333333334, 13.233333333333333, 13.283333333333333, 13.333333333333334, 13.383333333333333, 13.433333333333334, 13.483333333333333, 13.533333333333333, 13.583333333333334, 13.633333333333333, 13.683333333333334];
LengthOfShadow = [1.2472562046347977, 1.2227945902726263, 1.198921486169966, 1.1754289642509241, 1.1524395732531925, 1.1299174704375536, 1.1078354796629324, 1.0862542059757467, 1.0650810720316084, 1.0444462647738273, 1.024264126092484, 1.0046403137441777, 0.9854909081265032, 0.9667904943678335, 0.9485847352767173, 0.9309278812024055, 0.9137517496563277, 0.897109051342143, 0.8809737623788804, 0.8654922587753169, 0.8505044679482877];
    
syms x_min;
coefs = polyfit(time, LengthOfShadow, 2);
parabola =coefs(1) * x_min * x_min + coefs(2) * x_min + coefs(3);

ezplot(parabola, 12:16)
dy = diff(parabola);
x_min = solve(dy);
W = double(x_min);

syms D
Y = 2015;
N = 107;
TT = 12;
L = D/15; % Long Correction
dN = (W + L)/24; % Delta of time
N0 = 79.6764 + 0.2422 * (Y - 1985) - floor(0.25 * (Y - 1985));
Ct = W; % Standard Time
Lc = ((-120)-D*180/pi)*4/60; % Longtitude Correction 
Tm = Ct + Lc; % Avg. real sun time
Q = (2 * pi * 57.3 * (N + dN - N0) / 365.2422)/180*pi;
Eq = (0.0028 - 1.9857 * sin(Q) + 9.9059 * sin(2 * Q) ...
    - 7.0924 * cos(Q) - 0.6882 * cos(2 * Q))/60; % Time equation
% ezplot(Tm+Eq-12, [-105/180*pi, -120/180*pi])
sol = solve(12 == Tm + Eq, D);
D = double(subs(sol))*180/pi;
D
% -71.7715